"use strict";(self.webpackChunkgeoview_loader=self.webpackChunkgeoview_loader||[]).push([[763],{396:(e,n,r)=>{var t=r(6307),a=r(5379),i=r(5964),s=r(1339),o=r(5202),l=window;const c=function(e){var n=e.layersData,r=l.cgpv.ui.makeStyles((function(){return{layersContainer:{overflow:"hidden",overflowY:"auto",width:"100%"},layerItem:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"5px 0",padding:"10px 5px",boxSizing:"content-box","&:hover":{cursor:"pointer",backgroundColor:"#c9c9c9"},zIndex:1e3,border:"none",width:"100%"},layerParentText:{fontSize:"16px",fontWeight:"bold"},layerCountTextContainer:{display:"flex",alignItems:"center",width:"100%",height:"32px"},layerItemText:{fontSize:"14px",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",marginLeft:"10px"}}}))();return(0,o.jsx)("div",{className:r.layersContainer,children:Object.keys(n).map((function(e){var t=n[e];return(0,o.jsx)("div",{children:Object.keys(t.layers).map((function(e,n){var a=t.layers[e],i=a.layer,s=a.layerData,l=a.groupLayer;return(0,o.jsx)("div",{tabIndex:s.length>0&&!l?0:-1,onKeyDown:function(e){"Enter"===e.key&&(l||e.preventDefault())},role:"button",children:l?(0,o.jsx)("div",{className:r.layerParentText,title:i.name,children:i.name}):(0,o.jsx)("button",{type:"button",tabIndex:-1,className:r.layerItem,disabled:0===s.length,children:(0,o.jsx)("div",{className:r.layerCountTextContainer,children:(0,o.jsx)("div",{className:r.layerItemText,title:i.name,children:i.name})})})},n)}))},t.id)}))})};var u=r(1889),p=r(2537),d=r.n(p);function y(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function f(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?y(Object(r),!0).forEach((function(n){(0,i.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var b=function(){var e=(0,u.Z)(d().mark((function e(n){var r,t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(n,"?f=json"));case 2:return r=e.sent,e.next=5,r.json();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),v=function(e,n,r,t,a){var i,s,o=r[n.id].layers;o["".concat(t.id,"-").concat(t.name.replace(/\s+/g,"-").toLowerCase())]={layer:t,groupLayer:a,layerData:[],displayField:t.displayField||t.displayFieldName||"",fieldAliases:(i=t.fields,s={},i&&i.forEach((function(e){var n=e.name,r=e.alias;s[n]=r})),s),renderer:t.drawingInfo&&t.drawingInfo.renderer},r[n.id].layers=o,e((function(e){return f(f({},e),r)}))};const x=function(e,n,r){var t=n.map(r).layer.layers,a={};Object.keys(t).forEach(function(){var n=(0,u.Z)(d().mark((function n(r){var i,s,o,l,c,p,y,f,x;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=t[r],a[i.id]={id:i.id,name:i.name,type:i.type,layer:i.layer,layers:{}},"ogcWMS"!==i.type){n.next=18;break}s=i.entries,o=0;case 5:if(!(o<s.length)){n.next=16;break}return l=s[o],n.next=9,b(i.mapService.options.url+l);case 9:c=n.sent,p="".concat(i.url,"?request=GetLegendGraphic&version=1.0.0&Service=WMS&format=image/png&layer=").concat(l),c.drawingInfo&&c.drawingInfo.renderer&&c.drawingInfo.renderer.symbol&&Object.defineProperties(c.drawingInfo.renderer.symbol,{legendImageUrl:{value:p}}),v(e,i,a,c,!1);case 13:o++,n.next=5;break;case 16:n.next=26;break;case 18:if("esriFeature"!==i.type){n.next=25;break}return n.next=21,b(i.layer.options.url);case 21:y=n.sent,v(e,i,a,y,!1),n.next=26;break;case 25:"esriDynamic"===i.type&&(f=i.layer.getLayers(),x={},f.forEach((function(e){x[e]=e})),i.layer.metadata(function(){var n=(0,u.Z)(d().mark((function n(r,t){var s,o,l,c,u,p;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!r){n.next=2;break}return n.abrupt("return");case 2:if(!t.layers){n.next=25;break}s=0;case 4:if(!(s<t.layers.length)){n.next=25;break}if(!((o=t.layers[s]).id in x)){n.next=22;break}return n.next=9,b(i.layer.options.url+o.id);case 9:if(l=n.sent,v(e,i,a,l,null!==o.subLayerIds&&void 0!==o.subLayerIds),!o.subLayerIds){n.next=22;break}c=0;case 13:if(!(c<o.subLayerIds.length)){n.next=22;break}return u=o.subLayerIds[c],n.next=17,b(i.layer.options.url+u);case 17:p=n.sent,v(e,i,a,p,!1);case 19:c++,n.next=13;break;case 22:s++,n.next=4;break;case 25:case"end":return n.stop()}}),n)})));return function(e,r){return n.apply(this,arguments)}}()));case 26:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())};var h=window;const m=function(e){var n=e.mapId,r=h.cgpv,t=r.api,a=r.react,i=r.ui,l=a.useState,u=a.useEffect,p=l({}),d=(0,s.Z)(p,2),y=d[0],f=d[1],b=i.makeStyles((function(){return{mainContainer:{display:"flex",flexDirection:"row"}}}))();return u((function(){return x(f,t,n)}),[]),(0,o.jsx)("div",{className:b.mainContainer,children:(0,o.jsx)(c,{layersData:y})})};var g=window,w=function(){function e(n,r){var a=this;(0,t.Z)(this,e),(0,i.Z)(this,"translations",{"en-CA":{layersPanel:"Layers"},"fr-CA":{layersPanel:"Couches"}}),(0,i.Z)(this,"added",(function(){var e,n,r=a.LayersPanelPluginProps.mapId,t=g.cgpv.api,i=t.map(r).language,s={id:"layersPanelButton",tooltip:a.translations[i].layersPanel,tooltipPlacement:"right",icon:'<i class="material-icons">layers</i>',type:"textWithIcon"},l={title:a.translations[i].layersPanel,icon:'<i class="material-icons">layers</i>',width:200};a.buttonPanel=t.map(r).appBarButtons.createAppbarPanel(s,l,null),null===(e=a.buttonPanel)||void 0===e||null===(n=e.panel)||void 0===n||n.changeContent((0,o.jsx)(m,{buttonPanel:a.buttonPanel,mapId:r}))})),this.id=n,this.LayersPanelPluginProps=r,this.buttonPanel=null}return(0,a.Z)(e,[{key:"removed",value:function(){var e=this.LayersPanelPluginProps.mapId,n=g.cgpv.api;this.buttonPanel&&n.map(e).appBarButtons.removeAppbarPanel(this.buttonPanel.id)}}]),e}();g.plugins=g.plugins||{},g.plugins.layersPanel=w}},e=>{var n;n=396,e(e.s=n)}]);